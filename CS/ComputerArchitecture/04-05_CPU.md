## Ch04 CPU의 작동 원리

- CPU(Central Processing Unit)는 명령어를 읽어서 해석하고 실행하는 장치로 ALU, 제어 장치, 레지스터로 구성된다.

### ALU(Arithmetic and Logical Unit)
- ALU는 산술 논리 연산장치로 계산을 담당한다.
- ALU는 레지스터를 통해 피연산자를 받아들이고, 제어 장치로부터 수행할 연산에 대한 제어 신호를 받아서 연산을 수행하고 결과값을 내보낸다.
- ALU가 내보내는 결과값은 특정 숫자나 문자, 메모리 주소 등이 될 수 있으며 일시적으로 레지스터에 저장되었다가 메모리로 이동한다.
- ALU는 결과값 외에 연산 결과에 대한 추가적인 상태 정보인 플래그를 플래그 레지스터로 내보낸다.
- 대표적인 플래그로는 부호 플래그, 제로 플래그, 캐리 플래그, 오버플로우 플래그, 인터럽트 플래그, 슈퍼바이저 플래그 등이 있다.

### 제어 장치(Control Unit)
- 제어 장치는 명령어를 해석하고 컴퓨터 부품들을 관리하고 작동시키는 제어 신호를 내보내는 부품이다.
- 제어 장치는 클럭 신호, 해석해야 할 명령어, 플래그 값, 제어 신호 등을 받아들인다.
- 제어 장치는 레지스터, ALU, 메모리, 입출력장치 등으로 제어 신호를 내보낸다.

### 레지스터
- 레지스터는 CPU 안에 존재하는 작은 저장장치로 다양한 종류가 있다.
- 프로그램 카운터(Program Counter): 다음에 메모리에서 가져올 명령어의 주소를 저장, Instruction Pointer 라고도 한다.
- 명령어 레지스터(Instruction Register): 메모리에서 읽어 들인, 해석할 명령어를 저장하는 레지스터
- 메모리 주소 레지스터(Memory Address Register): CPU가 읽어 들이고자 하는 메모리의 주소를 저장하는 레지스터
- 메모리 버퍼 레지스터(Memory Buffer Register): 메모리와 주고받을 데이터 혹은 명령어를 저장하는 레지스터
- 범용 레지스터: 자유롭게 사용할 수 있는 레지스터
- 플래그 레지스터: ALU 연산 결과에 따른 플래그 정보를 저장하는 레지스터
- 스택 포인터: 스택에 마지막으로 저장한 값의 위치를 저장하는 레지스터
- 베이스 레지스터: 기준 주소를 저장하는 레지스터

### 명령어 사이클
- 명령어 사이클은 하나의 명령어를 처리하는 정형화된 흐름이다.
- 명령어 사이클은 인출 사이클, 실행 사이클, 간접 사이클, 인터럽트 사이클로 구성된다.
    - 인출 사이클: 메모리에 있는 명령어를 CPU로 가져오는 단계
    - 실행 사이클: 가져온 명령어를 해석하고 제어 신호를 발생시키는 단계
    - 간접 사이클: 추가적인 메모리 접근을 처리하는 단계
    - 인터럽트 사이클: 인터럽트를 처리하는 단계

### 인터럽트
- 인터럽트는 CPU의 정상적인 작업을 방해하는 신호
- 인터럽트는 CPU에 의해 발생하는 인터럽트인 동기 인터럽트(예외)와 입출력 장치 등에 의해 발생하는 비동기 인터럽트(하드웨어 인터럽트)로 나뉜다.
- 동기 인터럽트인 예외에는 폴트, 트랩, 중단, 소프트웨어 인터럽트가 있다.
    - 폴트: 인터럽트가 발생한 명령어부터 실행을 재개하는 예외
    - 트랩: 인터럽트가 발생한 명령어의 다음 명령어부터 실행을 재개하는 예외
    - 중단: CPU가 실행중인 프로그램을 강제로 중단하는 예외
    - 소프트웨어 인터럽트: 시스템콜이 발생했을 때 나타나는 예외
- 하드웨어 인터럽트는 CPU와 하드웨어의 처리 속도 차이 때문에 CPU의
- 인터럽트 요청 신호 → 인터럽트 플래그 → 인터럽트 벡터 → 인터럽트 서비스 루틴 실행
    - 인터럽트 플래그: CPU가 인터럽트를 처리할 수 있는 상태인지 표시
    - 인터럽트 벡터: 각 인터럽트를 처리하기 위해 수행 해야할 서비스 루틴 식별 정보
    - 인터럽트 서비스 루틴(ISR): 인터럽트를 처리하기 위한 프로그램


## Ch05 CPU 성능 향상 기법
### 클럭
- 컴퓨터 부품들은 클럭 신호에 맞춰 작동한다.
- 클럭 속도는 헤르츠(Hz) 단위로 측정한다.
- 클럭 속도는 1초에 클럭이 몇 번 반복되는지 나타낸다.

### 코어
- 코어란 명령어를 실행하는 부품이다.
- 코어가 여러개여도 처리할 연산이 적절히 분배되지 않는다면 연산 속도가 크게 증가하지 않는다.

### 스레드
- 스레드는 하드웨어적 스레드와 소프트웨어적 스레드로 나뉜다.
    - 하드웨어적 스레드: 하나의 코어가 동시에 처리하는 명령어 단위
    - 소프트웨어적 스레드: 하나의 프로그램에서 독립적으로 실행되는 단위
- 하나의 코어로 여러 명령어를 동시에 처리하는 CPU를 멀티스레드 프로세서라고 한다.
- 멀티스레드 프로세서는 여러 개의 레지스터 세트를 통해 여러 명령어를 동시에 처리한다.

### 명령어 병렬 처리 기법
- 명령어 병렬 처리 기법은 명령어를 동시에 처리하여 CPU를 쉬지 않고 작동시키는 기법이다.
**명령어 파이프라이닝**
- 명령어 처리 과정은 클럭 단위에 따라 인출 - 해석 - 실행 - 저장 으로 나뉜다.
- 명령어 파이프라인은 여러 명령어의 처리 과정에서 서로 다른 단계를 겹쳐서 실행하는 기법
- 파이프라이닝이 성능 향상에 실패하는 상황을 파이프라인 위험 이라고 한다.
    - 데이터 위험: 데이터 의존적인 명령어들을 동시에 실행할 때 발생
    - 제어 위험: 주로 분기 등으로 인해 프로그램 카운터가 갑작스럽게 변화할 때 발생
    - 구조적 위험: 서로 다른 명령어가 동시에 같은 CPU 부품을 사용하려고 할 때 발생
**슈퍼스칼라**
- CPU 내부에 여러 개의 명령어 파이프라인을 포함하는 기법
**비순차적 명령어 처리**
- 파이프라인의 중단을 방지하기 위해 명령어를 비순차적으로 처리하는 기법

### 명령어 집합(ISA)
- 명령어 집합(Instruction Set Architecture)은 CPU가 이해할 수 있는 명령어들의 모음이다.
- ISA는 CPU의 언어이자 하드웨어가 소프트웨어를 어떻게 이해할지에 대한 약속이다.
**CISC(Complex Instruction Set Computer)**
- 명령어의 형태와 크기가 다양한 가변 길이 명령어 집합
- CISC는 복잡하고 다양한 기능을 제공하기에 적은 수의 명령으로 프로그램을 동작시키고 메모리를 절약할 수 있지만 명령어의 규격화가 어려워 파이프라이닝이 어렵다.
**RISC(Reduced Instruction Set Computer)**
- 단순하고 적은 수의 고정 길이 명령어 집합
- 명령어가 규격화되어 있고, 하나의 명령어가 1클럭 내외로 실행되어 명령어 파이프라이닝에 최적화